<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>4.6 Manual Forms 1.3.4-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/overview.html"><strong>1</strong><span>Overview</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/installation.html"><strong>2</strong><span>Installation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/usersGuide.html"><strong>3</strong><span>User's Guide</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/developersGuide.html"><strong>4</strong><span>Developer's Guide</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/faq.html"><strong>5</strong><span>Frequently Asked Questions</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>jCatalog Software AG</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/usersGuide.html">&lt;&lt; <strong>3</strong><span>User's Guide</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/faq.html"><strong>5</strong><span>Frequently Asked Questions</span> >></a></div>
                


                <div class="project">
                    <h1>4.6 Manual Forms - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Stephan Albers, July Antonicheva</p>

                    <p><strong>Version:</strong> 1.3.4-SNAPSHOT</p>

                    
                </div>

                

                

<h2 id="manualForms">4.6 Manual Forms</h2>
<strong class="bold">Why do we use Manual Forms</strong><p class="paragraph"/>Sometimes it’s not convenient to use Grailsflow automatic forms for process flow. They have a number of restrictions.<p class="paragraph"/>All automatic forms have the same layout: the list of variables and the list of available events. In Grailsflow, there
is a possibility to create manual or custom forms. On your manual form you can use any styles, scripts, functionality.
See example.<p class="paragraph"/>Automatic form for HolidayRequest process definitions:<p class="paragraph"/><img border="0" class="center" src="../img/developersGuide/manualForms_1.jpg"></img><p class="paragraph"/>Custom form for the same process definition:<p class="paragraph"/><img border="0" class="center" src="../img/developersGuide/manualForms_2.jpg"></img><p class="paragraph"/><strong class="bold">Based on Grails: Groovy + GSPs</strong><p class="paragraph"/>The manual form creation if based on Groovy and GSP concepts - The manual (or custom) form is a GSP template that will
be rendered on the ‘Node Details’ page. When you decide that you need to create a form, the following links about
Grails, Groovy and GSP (groovy server pages) can be useful for you:
<ul class="star">
<li><a href="http://www.grails.org/" target="blank">http://www.grails.org/</a></li>
<li><a href="http://groovy.codehaus.org/" target="blank">http://groovy.codehaus.org/</a></li>
<li><a href="http://groovy.codehaus.org/GSP" target="blank">http://groovy.codehaus.org/GSP</a></li>
</ul><p class="paragraph"/><strong class="bold">How to create Manual Forms and integrate into Process definition</strong><p class="paragraph"/>When you decide that you need a manual instead of an automatic form for your node, there are two ways to do it:
<ul class="star">
<li> Create simple Manual form;</li>
<li> Create Manual form with Custom Controller</li>
</ul><p class="paragraph"/>The information for the second (Create Manual form with Custom Controller) option  can be found in chapter 11. This
feature works only in development mode.<p class="paragraph"/>When you finish with the form and press the ‘Generate’ button, the GSP template is generated and stored in the
application views. When the node is activated, the manual form will be rendered to the user. Each form belongs to the
process node and stored in views as - path‘views/manualForms/&#60;ProcessType&#62;/_&#60;ProcessNode&#62;.gsp’.
The Manual form is rendered as the part of the 'Node Details' page. Only server messages (standard error messages) can
be added to the page automatically (at the top of the page). If your form cannot be rendered, the error message will be
displayed.<p class="paragraph"/>
<strong class="bold">Access of Process Variables</strong><p class="paragraph"/>On the manual form you can access all process variables. They are in bean ‘nodeDetails’ that is available on the manual
form. You can get them by using the following signature:<p class="paragraph"/>${nodeDetails.variables}<p class="paragraph"/>Where 'variables' is a Map that contains entries
variableName: variableDetails
VariableDetails bean contains the following list of properties:
<ul class="star">
<li>   <strong class="bold">name</strong>           String variable name</li>
<li>   <strong class="bold">typeName</strong>  (changed to <strong class="bold">type</strong> since version 1.0)   type of variable</li>
<li>   <strong class="bold">label</strong>            Map of languageID -&#62; variable label</li>
<li>   <strong class="bold">description</strong>   Map of languageID -&#62; variable description</li>
<li>   <strong class="bold">value</strong>           Object variable value</li>
<li>   <strong class="bold">visibility</strong>        Variable visibility</li>
<li>   <strong class="bold">required</strong>      Is variable required or not</li>
<li>   <strong class="bold">view</strong>             View of variable (See more information in chapter 8)</li>
</ul><p class="paragraph"/>For example, you can access property 'value' of variable using the following notation:
${nodeDetails.variables.requesterName.value}<p class="paragraph"/><img border="0" class="center" src="../img/developersGuide/manualForms_3.jpg"></img><p class="paragraph"/>If you want your variable to be updated after form submitting you need to follow the rule that variable should have
property 'name' specified like:<p class="paragraph"/>name="var_&#60;variableName&#62;".<p class="paragraph"/>
<strong class="bold">Available Events (transitions)</strong><p class="paragraph"/>Also on the manual forms you can get information about all available transitions from current node. They are stored in
bean ‘nodeDetails’ and can be accessed using signature:<p class="paragraph"/>${nodeDetails.events}<p class="paragraph"/>Where "events" is a set of objects. Each object contains the next information about transition:
<ul class="star">
<li>   event;</li>
<li>   label (the Map of entries: languageID -&#62; event label) - it is used for making events translatable.</li>
</ul><p class="paragraph"/>    If you want to use transition on UI you need to take into account the following rule: your HTML submit component
    should have property ‘name’ specified like
    name = “event_&#60;event&#62;” .<p class="paragraph"/>See example:<p class="paragraph"/><img border="0" class="center" src="../img/developersGuide/manualForms_4.jpg"></img><p class="paragraph"/>Pay attention, that if you want to submit any information to the server you need to place it in  &#60;g:form&#62; tag. For more
information check <a href="http://www.grails.org/Tag+-+form" target="blank">http://www.grails.org/Tag+-+form</a>.<p class="paragraph"/><strong class="bold">Available Beans and Services</strong><p class="paragraph"/>There is a bean "nodeDetails" that is available on manual form. This bean is of type
com.jcatalog.grailsflow.engine.NodeDetails and contains the following info:<p class="paragraph"/>NodeDetails has following properties:
<ul class="star">
<li>   process        Object contains information about process</li>
<li>   nodeID         String node ID</li>
<li>   label             Map of  languageID -&#62; node label</li>
<li>   description    Map of languageID -&#62; node description</li>
<li>   caller            String node caller</li>
<li>   status            FlowStatus node status</li>
<li>   startedOn      Date node startedOn</li>
<li>   dueOn           Date node dueOn</li>
<li>   assignees      Set&#60;String&#62;   of assignee IDs</li>
<li>   events           Set&#60;EventDetails&#62; of events</li>
<li>   variables        Map of variableName -&#62; variableDetails</li>
</ul><p class="paragraph"/><strong class="bold">How to access DB entries</strong><p class="paragraph"/>On the custom form it is possible to access database instances using standard Grails possibilities (working with
domains) and Groovy tags:
<div class="code"><pre>&#60;g:select from=<span class="java&#45;quote">"$&#123;com.jcatalog.core.Country.list()&#125;"</span>
          optionKey=<span class="java&#45;quote">"countryId"</span>
          optionValue=<span class="java&#45;quote">"countryId"</span>
          value=<span class="java&#45;quote">"$&#123;orderAddress?.country&#125;"</span>/&#62;</pre></div><p class="paragraph"/>This example shows how to create selectbox with Countries (countryID are shown).<p class="paragraph"/>If you need to access the DB table, you need to specify the domain class (full class name) and then call one of the
dynamic methods that Grails provides for domains.<p class="paragraph"/>For example, you can get all entries from table Product:<p class="paragraph"/><div class="code"><pre>com.jcatalog.product.Product.list()</pre></div><p class="paragraph"/>or find products using some filters:
<div class="code"><pre>com.jcatalog.product.Product.findAllByProductIdLike(“%Printer%”)<p class="paragraph"/>com.jcatalog.product.Product.findWhere(productId:“Printer”, catalogId: “HP”)</pre></div><p class="paragraph"/>For more information about available dynamic methods,  see  <a href="http://grails.org/DomainClass+Dynamic+Methods" target="blank">http://grails.org/DomainClass+Dynamic+Methods</a> .<p class="paragraph"/>
<strong class="bold">Custom tags provided by Grailsflow</strong><p class="paragraph"/>For the automatic form you can specify ‘view’ and default values for each process variable. For the manual form you can
use all the same ‘views’ or tags. Among them:
<ul class="star">
<li>   SimpleView</li>
<li>   TextAreaView</li>
<li>   SelectBoxView</li>
<li>   CheckBoxView</li>
<li>   DateView</li>
<li>   LinkView</li>
<li>   DocumentView</li>
<li>   ListObjectsView</li>
<li>   ExternalSearchObjectView</li>
<li>   DefaultView</li>
</ul><p class="paragraph"/>TThe 'view' property can be specified for each process variable in the variable editor. Then, if you specify the view,
you can ask Grailsflow to use this 'view' for rendering the variable. For this reason, you can use 'variableInput'
Grailsflow tag (implemented in developing version):<p class="paragraph"/><div class="code"><pre>&#60;gf:variableInput variable=<span class="java&#45;quote">"$&#123;variable&#125;"</span>/&#62;</pre></div><p class="paragraph"/>If you do not specify 'view' templates for each process variable you can use view templates directly on the manual page:<p class="paragraph"/><div class="code"><pre>&#60;g:customizingTemplate
 template=<span class="java&#45;quote">"$&#123; com.jcatalog.grailsflow.model.view.CheckBoxView.template&#125;”
 model="</span>&#91;variable: variable, view: variable.view, parameterName: parameterName&#93;"/&#62;</pre></div><p class="paragraph"/>In the tag there are the following parameters:
<ul class="star">
<li>   template (that is the template that should be used for variable rendering);</li>
<li>   model (the information that will be available on the template.)</li>
</ul><p class="paragraph"/>The template requires ‘variable’ for rendering, ‘view’, and ‘parameterName’ – it provides to the server the name of the
variable for updating DB entries after submitting.)<p class="paragraph"/>Please see the example how to get ExternalSearchObjectView for variable.<p class="paragraph"/>You can use the following notations:
<div class="code"><pre>&#60;gf:variableInput variable=<span class="java&#45;quote">"$&#123;variable&#125;"</span>/&#62;</pre></div><p class="paragraph"/>Use this notation when variable 'view' and all necessary parameters for displaying external search (like displayKey,
URL for search) are specified in process script.
Also it's possible to get external search component using tag 'customizingTemplate':
<div class="code"><pre>&#60;g:customizingTemplate
 template=<span class="java&#45;quote">"$&#123;com.jcatalog.grailsflow.model.view.ExternalSearchObjectView.template&#125;”
 model="</span>&#91;variable: variable, view: variable.view, parameterName: parameterName&#93;"/&#62;</pre></div><p class="paragraph"/>In that case, all parameters that are necessary for ExternalSearchObjectView (e.g. displayKey, URL for external search)
will be taken from ‘variable.view’ object. But pay attention in that case you need to specify all these attributes for
the variable in Process Variable Editor.<p class="paragraph"/><img border="0" class="center" src="../img/developersGuide/manualForms_5.jpg"></img><p class="paragraph"/>If you did not configure 'View' for the process variable definition, it is possible to use External search too. You can
do it using Grails &#60;g:render&#62; tag. For ExternalSearchObjectView there are three parameters that you can specify:
<ul class="star">
<li>   displayKey (property for display in input field);</li>
<li>   searchUrl (is necessary, URL for external search page);</li>
<li>   additionalFields (Additional fields for displaying, they are usually displayed as readonly fields.);</li>
</ul><p class="paragraph"/>The following example should show external search component for Address object.
<div class="code"><pre>&#60;g:render contextPath=<span class="java&#45;quote">"$&#123;pluginContextPath&#125;"</span>
 template=<span class="java&#45;quote">"/variableViewTempaltes/externalSearchObjectView"</span>
 model=<span class="java&#45;quote">"&#91;variable:nodeDetails.variables.address,
 view:<span class="java&#45;keyword">new</span> com.jcatalog.grailsflow.model.view.ExternalSearchObjectView(displayKey:'addressID',
 searchUrl: 'search/address.gsp',
 additionalFields: 'name1, city'),
 parameterName: 'externalSearchObjectView_address'&#93;"</span>/&#62;</pre></div><p class="paragraph"/>Where:
<ul class="star">
<li>   contextPath      Path for template searching</li>
<li>   template         Template for rendering</li>
<li>   model            Information that should be available for the template</li>
</ul><p class="paragraph"/>In the 'model' you put 'variable' object. As you do not have a view specified for the variable, we can create it:
<div class="code"><pre><span class="java&#45;keyword">new</span> com.jcatalog.grailsflow.model.view.ExternalSearchObjectView(…)</pre></div><p class="paragraph"/>In the brackets, it is possible to define properties for this 'view'.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> com.jcatalog.grailsflow.model.view.ExternalSearchObjectView(displayKey: 'addressID', searchUrl: 'search/address.gsp', additionalFields: 'name1, city')</pre></div><p class="paragraph"/>As mentioned before, the events and variables have Maps of labels and descriptions (only variables have descriptions).
You can show the labels and descriptions according to the requested locale using Grailsflow tag 'translatedValue'’.<p class="paragraph"/>For example:
<div class="code"><pre>&#60;g:translatedValue translations=<span class="java&#45;quote">"$&#123;variable.label&#125;"</span> <span class="java&#45;keyword">default</span>=<span class="java&#45;quote">"$&#123;variable.name&#125;"</span> /&#62;</pre></div><p class="paragraph"/>or
<div class="code"><pre>&#60;g:translatedValue translations=<span class="java&#45;quote">"$&#123;variable.description&#125;"</span> <span class="java&#45;keyword">default</span>=<span class="java&#45;quote">""</span> /&#62;</pre></div><p class="paragraph"/><strong class="bold">How to include user owned GSP templates</strong><p class="paragraph"/>It is possible to include your own prepared templates into the manual form.You can do it using Grailsflow tag
“customizingTemplate”.
<div class="code"><pre>&#60;g:customizingTemplate template=<span class="java&#45;quote">"/myForms/eventForwarding"</span> model=<span class="java&#45;quote">"&#91;currentAssignees: nodeDetails.assignees&#93;"</span>/&#62;</pre></div><p class="paragraph"/><strong class="bold">Customize Return Controller and Action</strong><p class="paragraph"/>By default, after the manual step form execution, you will be forwarded to the Process Details page. You can customize
this behavior by specifying the return controller and action in your manual page. For example you can set it to
'showWorklist' - this means that after form submission, you will be redirected to the Worklist page. Please see the
following example:<p class="paragraph"/><div class="code"><pre>&#60;input type=<span class="java&#45;quote">"hidden"</span> name=<span class="java&#45;quote">"returnController"</span> value=<span class="java&#45;quote">"process"</span>/ &#62;
&#60;input type=<span class="java&#45;quote">"hidden"</span> name=<span class="java&#45;quote">"returnAction"</span> value=<span class="java&#45;quote">"showWorklist"</span>/ &#62;</pre></div><p class="paragraph"/>Releases of Grailsflow-1.0 and higher use parameters 'resultController', 'resultAction' instead of 'returnController',
'returnAction'.<p class="paragraph"/><strong class="bold">Multi-Step pages</strong><p class="paragraph"/>This feature works only in the development mode of Grails. It makes it possible to enhance process flow (add some
additional functionality and steps) without changing process definition. This can be done by using multi-step page. For
this, you need to select ‘Use Custom Controller and Form’ in Node Editor. In that case your ‘manual form’ content
(entered in the textarea) will be rendered as the first step. It should contain links/buttons that leads to the actions
in your Custom Controller. Your Custom Controller can make some actions and then render the next ‘step page’ (page can
be created using the ‘Add Multi-Step Page’ link). This step can lead to the Custom Controller and the Controller will
render the next step or redirect to the Grailsflow controller and continue the flow.<p class="paragraph"/>Multi-Step page belongs to the node and stored in the views under path, see some screenshots:<p class="paragraph"/><img border="0" class="center" src="../img/developersGuide/manualForms_6.jpg"></img><p class="paragraph"/>Add one more Step:<p class="paragraph"/><img border="0" class="center" src="../img/developersGuide/manualForms_7.jpg"></img><p class="paragraph"/>Multi-Step page belongs to node and stored in the views under path:<p class="paragraph"/>‘views/&#60;ProcessType&#62;&#60;ProcessNode&#62;/&#60;StepName&#62;.gsp’,<p class="paragraph"/>Pay attention that the name for the controller is generated by Grailsflow and it has view:<p class="paragraph"/>&#60;ProcessID_NodeID&#62;Controller.groovy<p class="paragraph"/>In the example above you can see that the form has “controller = ‘test_SetValues’”. Where ‘Test’ – is a name of Process,
and ‘SetValues’ is a name of node for which you prepare the manual form.<p class="paragraph"/>Pay attention that manual (or custom) form is included  in GSP page as template. This template is included in<p class="paragraph"/>&#60;g:form action="sendEvent" controller="process" ...&#62;  tag, it means that you should not use more forms in your manual
page. If you need to submit other form action you can use JavaScript features to change form action and controller.
For example:
<div class="code"><pre>&#60;input type=<span class="java&#45;quote">"button"</span> onclick=<span class="java&#45;quote">" <span class="java&#45;keyword">this</span>.form.action = ...; form.submit(); "</span> /&#62;</pre></div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/usersGuide.html">&lt;&lt; <strong>3</strong><span>User's Guide</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/faq.html"><strong>5</strong><span>Frequently Asked Questions</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    jCatalog Software AG
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
